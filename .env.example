# Kiro Gateway - Environment Configuration
# Copy this file to .env and fill in your values.

# ===========================================
# REQUIRED (Gateway Access)
# ===========================================

# Legacy gateway API key mode (single shared key for all clients).
# Keep for backward compatibility. If API_KEY_SOURCE=mongodb, this can stay empty.
# PROXY_API_KEY="change-me"

# ===========================================
# REQUIRED (Kiro Upstream Credentials)
# ===========================================

# Option 1: Kiro IDE credentials file (recommended)
# KIRO_CREDS_FILE="/Users/trantai/.aws/sso/cache/kiro-auth-token.json"
# KIRO_CREDS_FILE="/Users/trantai/Documents/kiro-gateway/test.json"
# Option 2: Direct refresh token (alternative)
# REFRESH_TOKEN="your_kiro_refresh_token_here"

# Option 3: kiro-cli SQLite database (AWS SSO/OIDC)
# KIRO_CLI_DB_FILE="~/.local/share/kiro-cli/data.sqlite3"

# AWS region for Kiro API
# KIRO_REGION="us-east-1"

# ===========================================
# API KEY AUTH SOURCE
# ===========================================

# Where gateway validates incoming API keys:
# - env: use PROXY_API_KEY (legacy)
# - mongodb: look up API key in MongoDB users collection (usersNew.apiKey)

# ===========================================
# MONGODB SETTINGS (for API key + credit billing)
# ===========================================

# MongoDB connection string (NO real secrets in this template)

MONGODB_URI="mongodb+srv://trantai306_db_user:FHBuXtedXaFLBr22@cluster0.aa02bn1.mongodb.net/?appName=Cluster0"
# Database name
MONGODB_DB_NAME="fproxy"


KIRO_AUTH_SOURCE="mongodb"
MONGODB_AUTH_KV_COLLECTION="auth_kv"

API_KEY_SOURCE="mongodb"


MONGODB_USERS_COLLECTION="usersNew"
MONGODB_USER_API_KEY_FIELD="apiKey"
MONGODB_USER_ID_FIELD="_id"
MONGODB_USER_ACTIVE_FIELD="isActive"
MONGODB_CREDITS_COLLECTION="usersNew"
MONGODB_CREDITS_USER_ID_FIELD="_id"
MONGODB_CREDITS_BALANCE_FIELD="creditsNew"

# ===========================================
# CREDIT BILLING SETTINGS
# ===========================================

# Enable/disable credit validation and deduction
BILLING_ENABLED="true"

# Reject request if user has insufficient credits
BILLING_ENFORCE_SUFFICIENT_CREDITS="true"

# Currency precision used when deducting credits
# Common values: 4 or 6
BILLING_DECIMAL_PLACES="6"

# Model pricing config (JSON string).
# Price unit: per 1,000,000 tokens.
# Billing formula suggestion:
#   total = ((input * input_price_per_mtok)
#          + (output * output_price_per_mtok)
#          + (cache_write * cache_write_price_per_mtok)
#          + (cache_hit * cache_hit_price_per_mtok))
#          / 1_000_000
#   charged = total * billing_multiplier
#
# Use canonical model IDs after normalization in your resolver.
BILLING_MODEL_PRICES_JSON='[
  {
    "name": "Claude Sonnet 4.5",
    "id": "claude-sonnet-4-5-20250929",
    "input_price_per_mtok": 3.0,
    "output_price_per_mtok": 15.0,
    "cache_write_price_per_mtok": 3.75,
    "cache_hit_price_per_mtok": 0.3,
    "billing_multiplier": 1.2
  },
  {
    "name": "Claude Haiku 4.5",
    "id": "claude-haiku-4-5-20251001",
    "input_price_per_mtok": 1.0,
    "output_price_per_mtok": 5.0,
    "cache_write_price_per_mtok": 1.25,
    "cache_hit_price_per_mtok": 0.1,
    "billing_multiplier": 1.2
  }
]'

# Fallback behavior if model ID not found in BILLING_MODEL_PRICES_JSON
# - reject: return error
# - free: no deduction
# - default: use BILLING_DEFAULT_* values
BILLING_UNKNOWN_MODEL_POLICY="default"

# Used only when BILLING_UNKNOWN_MODEL_POLICY=default
BILLING_DEFAULT_INPUT_PRICE_PER_MTOK="3.0"
BILLING_DEFAULT_OUTPUT_PRICE_PER_MTOK="14.0"
BILLING_DEFAULT_CACHE_WRITE_PRICE_PER_MTOK="3.75"
BILLING_DEFAULT_CACHE_HIT_PRICE_PER_MTOK="0.3"
BILLING_DEFAULT_MULTIPLIER="1.1"

# BILLING_USD_PER_CREDIT="0.04"

MODEL_ALLOWLIST_ENABLED="true"
MODEL_ALLOWED_IDS_JSON='[
  "claude-sonnet-4.5",
  "claude-haiku-4.5",
  "claude-sonnet-4-5-20250929",
  "claude-haiku-4-5-20251001"
]'
# ===========================================
# SERVER SETTINGS
# ===========================================

# SERVER_HOST="0.0.0.0"
# SERVER_PORT="8000"

# ===========================================
# NETWORK / TIMEOUT SETTINGS
# ===========================================

# VPN_PROXY_URL="http://127.0.0.1:7890"
# FIRST_TOKEN_TIMEOUT="15"
# FIRST_TOKEN_MAX_RETRIES="3"
# STREAMING_READ_TIMEOUT="300"

# ===========================================
# OPTIONAL FEATURES
# ===========================================

# FAKE_REASONING=true
# FAKE_REASONING_MAX_TOKENS=4000
# FAKE_REASONING_HANDLING=as_reasoning_content
# FAKE_REASONING_INITIAL_BUFFER_SIZE=20

# TRUNCATION_RECOVERY=true

# ===========================================
# LOGGING / DEBUG
# ===========================================

# LOG_LEVEL="INFO"
# DEBUG_MODE=off
# DEBUG_DIR="debug_logs"
